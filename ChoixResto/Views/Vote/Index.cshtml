@model ChoixResto.ViewModels.RestaurantVoteViewModel

@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>Index</title>
    <script type="text/javascript" src="~/scripts/jquery-1.7.1.js"></script>
    <script type="text/javascript" src="~/scripts/jquery.validate-vsdoc.js"></script>
    <script type="text/javascript" src="~/scripts/jquery.validate.unobtrusive.js"></script>
    <script type="text/javascript">
        jQuery.validator.addMethod("verifListe", function (value, element, params) {
            var nombreCoche = $('input:checked[data-val-verifListe]').length;
            if (nombreCoche == 0) {
                $('span[data-valmsg-for=ListeDesResto]').text(params.message).removeClass("field-validation-valid").addClass("field-validation-error");
            }
            else {
                $('span[data-valmsg-for=ListeDesResto]').text('');
            }
            return nombreCoche != 0;
        });

        jQuery.validator.unobtrusive.adapters.add
            ("verifListe", function (options) {
                options.params.message = options.message;
                options.rules["verifListe"] = options.params;
                options.messages["verifListe"] = options.message;
            });
    </script>
</head>
<body>
    <div> 
        <p>Cochez les restaurants ou vous voulez aller. Attention, le vote est définitif !</p>
         @Html.ValidationMessageFor(m => m.ListeDesResto,String.Empty, new { @style="color: red"})
         @using (Html.BeginForm())
         {
             for (int i = 0; i < Model.ListeDesResto.Count; i++)
             {
                @Html.CheckBoxFor(m => m.ListeDesResto[i].EstSelectionne, new { data_val_verifListe = "Vous devez choisir au moins un restaurant" })
                @Html.LabelFor(m => m.ListeDesResto[i].EstSelectionne, Model.ListeDesResto[i].NomEtTelephone)<br />
                @Html.HiddenFor(m => m.ListeDesResto[i].Id)
                @Html.HiddenFor(m =>m.ListeDesResto[i].NomEtTelephone)
            }

            <input type="submit" value="Voter" />
        }
    </div>
</body>
</html>
